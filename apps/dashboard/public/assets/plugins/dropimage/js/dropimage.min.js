(function($) {
  $.fn.showImage = function($file, $image) {
    var $dropimage = $(this);
    var fileType = $file["type"];
    var validImageTypes = ["image/jpg", "image/jpeg", "image/png", "image/gif"];
    if ($file != null) {
      if ($.inArray(fileType, validImageTypes) > 0) {
        var reader = new FileReader();
        reader.onload = function(e) {
          $dropimage.addClass("active");
          $image.attr("src", e.target.result);
        }
        reader.readAsDataURL($file);
      }
    }
  }

  $.fn.dropImage = function() {
    var $dropimage = $(this);
    var $input = $dropimage.find("input[type=file]");
    var $image = $dropimage.find("img");
    var $fileProperties;
    var $file;

    $dropimage.on("dragover", function(event) {
      event.preventDefault();
      event.stopPropagation();
      $dropimage.addClass("dragging");
    });

    $dropimage.on("dragleave", function(event) {
      event.preventDefault();
      event.stopPropagation();
      $dropimage.removeClass("dragging");
    });

    $dropimage.on("drop", function(event) {
      event.preventDefault();
      event.stopPropagation();
      $dropimage.removeClass("dragging");
      $file = event.originalEvent.dataTransfer.files[0];
      $fileProperties = event.originalEvent.dataTransfer.files;
      $input.prop("files", $fileProperties);
      $dropimage.showImage($file, $image);
    });

    $input.on("change", function() {
      $file = this.files[0];
      $dropimage.showImage($file, $image);
    });
  }
}(jQuery));
